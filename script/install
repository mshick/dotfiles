#!/usr/bin/env bash
#
# Run all dotfiles installers.

cd "$(dirname "$0")/.."
DOTFILES_ROOT=$(pwd)

export DOTFILES=$HOME/.dotfiles

# Source utils
source "$DOTFILES/util/interactive"

# Install Homebrew
$DOTFILES/homebrew/install.sh 2>&1

# Upgrade Homebrew
echo "› brew update"
brew update

cd "$(dirname $0)"/..

# Run Homebrew through the Brewfile

user ' - Which brew bundle should I install? Type `server` or `client`.'
read -e bundle_type

echo "› brew bundle"
cd "$DOTFILES/homebrew/bundles/$bundle_type"
brew bundle -v

# find the installers and run them iteratively
set -e

find $DOTFILES -name install.sh | while read installer ; do sh -c "${installer}" ; done

# Set OS X defaults
$DOTFILES/macos/set-defaults.sh

echo "Done installing!"
